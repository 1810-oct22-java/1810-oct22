/*
 * ###########################################
 * EMPLOYEE VIEWS
 * ###########################################
 */
window.onload = function() {
	loadEmpView();
}

function loadEmpView() {
	var xhr = new XMLHttpRequest();
	
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			//do things w/ response
			$('#view').html(xhr.responseText);
			$('#fileReimbNav').on('click',loadFileReimbView);
			$('#viewPastNav').on('click',loadPastView);
			$('#logOut').on('click',loadLoginView);
		}
	}
	xhr.open("GET", "employee.view", true);
	xhr.send();
}

function loadFileReimbView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
			$('#homeNav').on('click',loadEmpView);
			$('#viewPastNav').on('click',loadPastView);
			$('#logOut').on('click',loadLoginView);
		}
	}
	xhr.open("GET", "reimb.view", true);
	xhr.send();
		
}

function loadPastView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
			$('#homeNav').on('click',loadEmpView);
			$('#fileReimbNav').on('click',loadFileReimbView);
			$('#logOut').on('click',loadLoginView);
			loadReimbs();
		}
	}
	xhr.open("GET", "past.view", true);
	xhr.send();
		
}

function addReimb() {
	
	var date = $('#Date').val();
	var amount = $('#Amount').val();
	var type = $('#reimbType').val();
	var description = $('#Desc').val();
	var obj = {
			
			Submitted: date,
			Amount: amount,
			Type: type,
			Description: description
	};
	var toSend = JSON.stringify(obj);
	
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4) {
			console.log(xhr.status);
			console.log(xhr.responseText);
			console.log(xhr.responseType);
		}
	}
	xhr.open("POST","past");
	xhr.send(toSend);
	
}

function loadReimbs(){
	var xhr = new XMLHttpRequest();
	
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			console.log(xhr.responseText);
			let reimbs = JSON.parse(xhr.responseText);
			for (let r of reimbs) {
				if (r.status == "1") {
					var status = "Pending";
				}
				else if (r.status =="2") {
					var status = "Approved";
				}
				else {
					var status = "Denied";
				}
				var th = $(`<tr>
					<td>${r.time}</td>
					<td>${r.description}</td>
					<td>${r.amount}</td>
					<td>${status}
					</tr>`);
				$('#reimbList tr:last').after(th);
			}
		}
	}
	xhr.open("GET","past");
	xhr.send();
}