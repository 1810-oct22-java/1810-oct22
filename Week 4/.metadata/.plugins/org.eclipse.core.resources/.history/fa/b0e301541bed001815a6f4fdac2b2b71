/**
 * 
 */

window.onload = function() {
    loadLoginView();
    $('#login').on('click',loadProfileView);
    $('#homeNav').on('click',loadHomeView);
    $('#reimbNav').on('click',loadReimbView);
    $('#viewNav').on('click',loadPastView);
    $('#authorNav').on('click',loadAuthorsView);
}

function loadLoginView() {
	var xhr = new XMLHttpRequest();
	
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			//do things w/ response
			$('#view').html(xhr.responseText);
		}
	}
	xhr.open("GET", "home.view", true);
	xhr.send();
	
}

function loadBooksView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
		}
	}
	xhr.open("GET", "books.view", true);
	xhr.send();
		
}

function loadGenresView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
			// manipulate Genre view
			getGenres();
			$('#addGenre').on('click', addGenre);
		}
	}
	xhr.open("GET", "genre.view", true);
	xhr.send();
		
}

function getGenres() {
	var xhr = new XMLHttpRequest();
	
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			console.log(xhr.responseText);
			let genres = JSON.parse(xhr.responseText);
			for (let g of genres) {
				var li = $(`<li>${g.name}<li>`);
				$('#genreList').append(li);
			}
		}
	}
	xhr.open("GET","genres");
	xhr.send();
}

function addGenre() {
	
	var genre = $('#newGenre').val();
	var obj = {
			
			name: genre
	};
	var toSend = JSON.stringify(obj);
	
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4) {
			console.log(xhr.status);
			console.log(xhr.responseText);
			console.log(xhr.responseType);
		}
	}
	xhr.open("POST","genres");
	xhr.send(toSend);
	
}

function loadAuthorsView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
		}
	}
	xhr.open("GET", "author.view", true);
	xhr.send();
		
}