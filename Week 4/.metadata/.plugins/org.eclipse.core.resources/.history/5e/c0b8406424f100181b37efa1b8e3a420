/*
 * #############################################
 * MANAGER VIEWS
 * #############################################
 */
window.onload = function () {
	loadManView();
}

function loadManView() {
	var xhr = new XMLHttpRequest();
	
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			//do things w/ response
			$('#view').html(xhr.responseText);
			$('#pendingNav').on('click',loadPendingView);
			$('#oldNav').on('click',loadPastView)
			$('#logoutNav').on('click',loadLoginView);
		}
	}
	xhr.open("GET", "manager.view", true);
	xhr.send();
}

function loadPendingView() {
	var xhr = new XMLHttpRequest();

	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
			$('#homeNav').on('click',loadManView);
			$('#oldNav').on('click',loadOldView);
			$('#logoutNav').on('click',loadLoginView);
			loadPendingReimbs();
		}
	}
	xhr.open("GET", "pending.view", true);
	xhr.send();
		
}

function loadPendingReimbs(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			console.log(xhr.responseText);
			let reimbs = JSON.parse(xhr.responseText);
			for (let r of reimbs) {
				var th = $(`<tr>
					<td>${r.time}</td>
					<td>${r.description}</td>
					<td>${r.amount}</td>
					<td>
						<select class="form-control" id="Option">
							<option value="Approve">Approve</option>
							<option value="Deny">Deny</option>
						</select>
					</td>
					</tr>`);
				$('#pendReimbList tr:last').after(th);
			}
		}
	}
	xhr.open("GET","pending");
	xhr.send();
}

function loadOldView() {
	var xhr = new XMLHttpRequest();
	console.log("hello");
	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			// do things w/ response
			$('#view').html(xhr.responseText);
			$('#homeNav').on('click',loadManView);
			$('#pendingNav').on('click',loadPendingView);
			$('#logoutNav').on('click',loadLoginView);
			loadOldReimbs();
		}
	}
	xhr.open("GET", "old.view", true);
	xhr.send();
		
}

function loadOldReimbs(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if(xhr.readyState == 4 && xhr.status == 200) {
			console.log(xhr.responseText);
			let reimbs = JSON.parse(xhr.responseText);
			for (let r of reimbs) {
				if (r.status=="2") {
					var status = "Approved";
				} 
				else {
					var status = "Denied";
				}
				var th = $(`<tr>
					<td>${r.time}</td>
					<td>${r.description}</td>
					<td>${r.amount}</td>
					<td>${status}
					</tr>`);
				$('#oldReimbList tr:last').after(th);
			}
		}
	}
	xhr.open("GET","old");
	xhr.send();
}